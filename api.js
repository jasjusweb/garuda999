if(typeof QRCode==='undefined'){let s=document.createElement('script');s.src='https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js';document.head.appendChild(s)}
if(typeof jQuery!=='undefined'){if($('link[href*="font-awesome"]').length===0){let l=document.createElement('link');l.rel='stylesheet';l.href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css';document.head.appendChild(l)}
function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}
function parseQrisMerchantName(q){const t='59';const i=q.indexOf(t);if(i===-1)return null;const l=i+t.length;const n=q.substring(l,l+2);const a=parseInt(n,10);if(isNaN(a))return null;const s=l+2;return q.substring(s,s+a)}
function generateQrisPayload(o,a){function c(d){let c=0xFFFF;for(let b=0;b<d.length;b++){c^=d.charCodeAt(b)<<8;for(let e=0;e<8;e++)c=(c&0x8000)?(c<<1)^0x1021:c<<1}
return('0000'+(c&0xFFFF).toString(16).toUpperCase()).slice(-4)}
const t='5802ID';const i=o.indexOf(t);if(i===-1)throw new Error("Format qrisString tidak valid.");const p=o.substring(0,i);const s=o.substring(i);const m=a.toString();const l=m.length.toString().padStart(2,'0');const n=`54${l}${m}`;const r=`${p}${n}${s}6304`;const u=c(r);return `${p}${n}${s}6304${u}`}
jQuery(document).ready(function($){if($('.qris-cepat-wrapper-v11').length>0){return}
let qT=null;let bC=null;let pIR=null;let accountData=null;function compressImage(file,maxSizeInMB=1){return new Promise((resolve,reject)=>{const reader=new FileReader();reader.readAsDataURL(file);reader.onload=(event)=>{const img=new Image();img.src=event.target.result;img.onload=()=>{const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');const MAX_WIDTH=1920;const MAX_HEIGHT=1080;let width=img.width;let height=img.height;if(width>height){if(width>MAX_WIDTH){height*=MAX_WIDTH/width;width=MAX_WIDTH}}else{if(height>MAX_HEIGHT){width*=MAX_HEIGHT/height;height=MAX_HEIGHT}}
canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0,width,height);canvas.toBlob((blob)=>{if(blob.size<file.size){resolve(blob)}else{resolve(file)}},'image/jpeg',0.7)};img.onerror=(error)=>reject(error)};reader.onerror=(error)=>reject(error)})}
const cS=`
.qris-cepat-wrapper-v11,.qris-cepat-wrapper-v11 *{box-sizing:border-box}.qris-cepat-wrapper-v11{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif}.qris-cepat-wrapper-v11 .cepat-form-container{display:none;background-color:#fff;border-radius:12px;box-shadow:0 4px 15px rgb(0 0 0 / .07);overflow:hidden}.qris-cepat-wrapper-v11 .cepat-input-area{padding:25px}.qris-cepat-wrapper-v11 .depo-tabs{display:flex;gap:8px;margin-bottom:20px;background-color:#2d3436;padding:6px;border-radius:12px;border:1px solid rgb(255 255 255 / .1)}.qris-cepat-wrapper-v11 .tab{flex:1;padding:8px 10px;cursor:pointer;color:#dfe6e9;font-weight:600;text-align:center;border-radius:8px;transition:all 0.3s ease;display:flex;align-items:center;justify-content:center;gap:6px;font-size:.85rem;border:none;background-color:rgb(255 255 255 / .05);position:relative;overflow:visible}.qris-cepat-wrapper-v11 .tab.active{background-color:#00a2b1;color:#fff;box-shadow:0 0 15px rgb(0 162 177 / .7);transform:translateY(-2px)}.qris-cepat-wrapper-v11 .tab i{font-size:1rem}.qris-cepat-wrapper-v11 .tab[data-target="qris"]::after,.qris-cepat-wrapper-v11 .tab[data-target="qris2"]::after{content:'CEPAT';position:absolute;top:-8px;right:-8px;background:linear-gradient(45deg,#e74c3c,#c0392b);color:#fff;padding:3px 8px;border-radius:7px;font-size:.65rem;font-weight:700;box-shadow:0 2px 5px rgb(0 0 0 / .2);animation:pulse-badge 2s infinite ease-in-out;z-index:1}.qris-cepat-wrapper-v11 .tab[data-target="qris2"]::after{content:'MANUAL';background:linear-gradient(45deg,#f39c12,#e67e22)}.qris-cepat-wrapper-v11 .form-group{margin-bottom:25px}.qris-cepat-wrapper-v11 label{display:block;font-weight:600;margin-bottom:10px;color:#34495e;font-size:.95rem;text-transform:none}.qris-cepat-wrapper-v11 .form-control{height:50px!important;width:100%;padding:.8rem 1.2rem;font-size:1rem;color:#212529;background-color:#f1f3f5;border:2px solid #fff0;border-radius:12px;transition:all 0.2s ease-in-out}.qris-cepat-wrapper-v11 .form-control:focus{background-color:#fff;border-color:#00a2b1;box-shadow:0 0 0 3px rgb(0 162 177 / .25);outline:none}.form-control.is-invalid{border-color:#d9534f!important;animation:shake 0.6s}.qris-validation-message{display:none;align-items:center;gap:8px;padding:10px 12px;background-color:#fff6f6;border-left:4px solid #e57373;border-radius:8px;color:#c62828;font-size:.875rem;font-weight:500;margin-top:10px}.qris-validation-message::before{font-family:"Font Awesome 6 Free";content:"\\f071";font-weight:900}.payment-method-box{background-color:#e0f7fa;border:2px solid #00a2b1;border-radius:12px;padding:10px 15px;display:flex;align-items:center;justify-content:center}.payment-method-box img{height:35px;width:auto}.quick-amount-selector{display:flex;flex-wrap:nowrap;overflow-x:auto;gap:10px;padding-bottom:15px;scrollbar-width:thin;scrollbar-color:#00a2b1 #f1f1f1}.quick-amount-btn{flex-shrink:0;padding:10px 18px;background-color:#f1f5f9;border:2px solid #e2e8f0;color:#475569;border-radius:12px;cursor:pointer;transition:all 0.2s ease;text-align:center;font-weight:600;font-size:.9rem}.quick-amount-btn:hover{transform:translateY(-2px);box-shadow:0 2px 5px rgb(0 0 0 / .1)}.quick-amount-btn.active{border-color:#00a2b1;background-color:#e0f7fa;color:#00796b;transform:translateY(-2px);box-shadow:0 0 0 3px rgb(0 162 177 / .25)}.input-group-promo{display:flex;align-items:stretch;position:relative}.input-group-promo .input-group-text,.input-group-promo .form-control,.input-group-promo .promo-trigger-btn,.input-group-promo .clear-input-btn{height:50px!important}.input-group-promo .input-group-text{display:flex;align-items:center;padding:.8rem 1rem;font-weight:600;color:#495057;background-color:#e9ecef;border:1px solid #ced4da;border-radius:12px 0 0 12px;border-right:0}.input-group-promo .form-control{border-radius:0!important}.promo-trigger-btn{width:50px;border:1px solid #ced4da;border-left:none;background-color:#f8f9fa;cursor:pointer;border-radius:0 12px 12px 0;transition:background-color .2s ease;display:flex;align-items:center;justify-content:center}.promo-trigger-btn:hover{background-color:#e9ecef}.promo-trigger-btn i{color:#00a2b1;font-size:1.2rem;animation:blinkPromo 1.5s infinite alternate}.promo-trigger-btn.active i{color:#28a745;animation:none}.input-group-promo .bonus-label{position:absolute;top:-10px;right:5px;background:linear-gradient(45deg,#f1c40f,#f39c12);color:#4f3905;padding:3px 8px;border-radius:7px;font-size:.65rem;font-weight:800;z-index:1;pointer-events:none;box-shadow:0 2px 5px rgb(0 0 0 / .2);animation:glow-bonus 2s infinite alternate}.clear-input-btn{position:absolute;right:55px;top:0;font-size:1.5rem;color:#999;cursor:pointer;display:none;line-height:50px;padding:0 5px;z-index:3}.clear-input-btn:hover{color:#333}.selected-promo-info{position:relative;padding:8px 12px;color:#333;background-color:#e0f7fa;border-radius:8px;margin-top:10px;font-size:.85rem;font-weight:500;display:none;line-height:1.6;border-left:4px solid #00a2b1}.clear-promo-btn{position:absolute;top:50%;right:10px;transform:translateY(-50%);font-size:22px;font-weight:700;color:#008b8b;cursor:pointer;line-height:1;transition:color .2s ease}.clear-promo-btn:hover{color:#d9534f}.unique-code-info{display:none;margin-top:10px;padding:10px 12px;background-color:#f1f5f9;border-radius:8px;font-size:.9rem;color:#334155;text-align:center}.cepat-button{width:100%;padding:16px;border:none;border-radius:12px;color:#fff;font-size:1.1rem;font-weight:700;cursor:pointer;margin-top:24px;background-color:#00a2b1;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 15px rgb(0 162 177 / .3)}.cepat-button:hover:not(:disabled){background-color:#00796b;transform:translateY(-3px);box-shadow:0 6px 20px rgb(0 162 177 / .4)}.cepat-button:disabled{background-color:#6c757d;cursor:not-allowed;box-shadow:none}.result-container,.expired-container,.success-container{display:flex;flex-direction:column;align-items:center;text-align:center;padding:30px}.barcode-display{padding:15px;border:1px solid #eee;border-radius:16px;margin:10px auto;width:100%;max-width:300px;display:block;background:#fff;box-shadow:0 4px 15px rgb(0 0 0 / .07)}.barcode-display canvas,.barcode-display img{width:100%!important;height:auto!important;border-radius:8px}#qris2-barcode-container{padding:15px;border:1px solid #eee;border-radius:16px;margin:10px auto 20px auto;width:100%;max-width:300px;min-height:150px;display:flex;align-items:center;justify-content:center;background:#fff;box-shadow:0 4px 15px rgb(0 0 0 / .07)}#qris2-barcode-container img{max-width:100%;height:auto;border-radius:8px}.final-amount{font-size:2.2rem;color:#28a745;font-weight:700;display:block;margin:15px 0 5px 0;letter-spacing:-1px}.timer-container,.merchant-info{font-size:1rem;color:#555;margin-bottom:15px}.merchant-info{display:flex!important;align-items:center;justify-content:center;gap:8px;font-size:.9rem;color:#4A5568;background:#edf2f7;padding:8px 15px;border-radius:20px}.payment-timer{font-weight:700;color:#d9534f}.expired-container{padding:40px 20px;background-color:#fff6f6;border:2px solid #d9534f;border-radius:10px}.expired-container h3{color:#d9534f}.buat-ulang-btn,.download-btn{background-color:#6c757d;color:#fff;padding:12px 20px;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;gap:8px;margin-top:15px;font-weight:600;transition:background-color 0.2s ease}.buat-ulang-btn:hover,.download-btn:hover{background-color:#5a6268}.success-container{padding:40px 20px;background-color:#fff;border-radius:15px}.success-container h3{font-size:1.5rem;color:#333;margin-bottom:8px}.success-container p{color:#4A5568;margin-top:0}.svg-checkmark{width:80px;height:80px;border-radius:50%;display:block;stroke-width:3;stroke:#28a745;stroke-miterlimit:10;margin:0 auto 20px auto;box-shadow:inset 0 0 0 #28a745;animation:fill .4s ease-in-out .4s forwards,scale .3s ease-in-out .9s both}.svg-checkmark__circle{stroke-dasharray:166;stroke-dashoffset:166;stroke-width:3;stroke-miterlimit:10;stroke:#28a745;fill:none;animation:stroke .6s cubic-bezier(.65,0,.45,1) forwards}.svg-checkmark__check{transform-origin:50% 50%;stroke-dasharray:48;stroke-dashoffset:48;stroke:#fff;animation:stroke .3s cubic-bezier(.65,0,.45,1) .8s forwards}.promo-modal{display:block;visibility:hidden;opacity:0;position:fixed;z-index:99999;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgb(0 0 0 / .5);transition:opacity .3s ease,visibility .3s ease}.promo-modal.modal-visible{visibility:visible;opacity:1}.promo-modal-content{position:relative;background-color:#fefefe;margin:10% auto;padding:0;border:none;width:95%;max-width:400px;border-radius:16px;box-shadow:0 4px 8px 0 rgb(0 0 0 / .2);animation:slideIn .4s;overflow:hidden}.promo-modal-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;border-bottom:1px solid #e9ecef}.promo-modal-header h4{margin:0;font-size:1.2rem;font-weight:600;color:#333}.close-modal-btn{color:#aaa;background:none;border:0;font-size:28px;font-weight:700;cursor:pointer;padding:0 5px}.promo-modal-body{padding:15px 20px;max-height:60vh;overflow-y:auto}.promo-item{color:#333;padding:15px;border:2px solid #e9ecef;border-radius:12px;margin-bottom:12px;cursor:pointer;transition:all .2s ease}.promo-item:hover{border-color:#00a2b1;background-color:#f0f8ff}.promo-item.active{border-color:#00a2b1;background-color:#e0f7fa;font-weight:600}.promo-item p{margin:0;font-weight:600}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideIn{from{transform:translateY(-50px)}to{transform:translateY(0)}}@keyframes blinkPromo{from{opacity:1;transform:scale(1)}to{opacity:.6;transform:scale(.9)}}@keyframes stroke{100%{stroke-dashoffset:0}}@keyframes pulse-badge{0%{transform:scale(1) rotate(0deg)}50%{transform:scale(1.08) rotate(3deg)}100%{transform:scale(1) rotate(0deg)}}@keyframes glow-bonus{from{box-shadow:0 0 3px #f1c40f}to{box-shadow:0 0 10px #f39c12,0 0 5px #f1c40f}}@keyframes scale{0%,100%{transform:none}50%{transform:scale3d(1.1,1.1,1)}}@keyframes fill{100%{box-shadow:inset 0 0 0 40px #28a745}}@keyframes shake{10%,90%{transform:translate3d(-1px,0,0)}20%,80%{transform:translate3d(2px,0,0)}30%,50%,70%{transform:translate3d(-4px,0,0)}40%,60%{transform:translate3d(4px,0,0)}}@media (max-width:768px){.qris-cepat-wrapper-v11 .cepat-input-area{padding:20px}.qris-form-container .input-group-promo .form-control,.qris2-form-container .input-group-promo .form-control{position:relative;top:-10px}}

`;
$('head').append(`<style>${cS}</style>`);const quickAmountButtonsHTML=`<button type="button" class="quick-amount-btn" data-amount="25000">25rb</button><button type="button" class="quick-amount-btn" data-amount="50000">50rb</button><button type="button" class="quick-amount-btn" data-amount="75000">75rb</button><button type="button" class="quick-amount-btn" data-amount="100000">100rb</button><button type="button" class="quick-amount-btn" data-amount="200000">200rb</button><button type="button" class="quick-amount-btn" data-amount="250000">250rb</button><button type="button" class="quick-amount-btn" data-amount="500000">500rb</button><button type="button" class="quick-amount-btn" data-amount="1000000">1jt</button><button type="button" class="quick-amount-btn" data-amount="2000000">2jt</button><button type="button" class="quick-amount-btn" data-amount="3000000">3jt</button><button type="button" class="quick-amount-btn" data-amount="4000000">4jt</button><button type="button" class="quick-amount-btn" data-amount="5000000">5jt</button><button type="button" class="quick-amount-btn" data-amount="6000000">6jt</button><button type="button" class="quick-amount-btn" data-amount="7000000">7jt</button><button type="button" class="quick-amount-btn" data-amount="8000000">8jt</button><button type="button" class="quick-amount-btn" data-amount="9000000">9jt</button><button type="button" class="quick-amount-btn" data-amount="10000000">10jt</button>`;const hM=`
<div class="qris-cepat-wrapper-v11"><div class="depo-tabs"><button type="button" class="tab" data-target="manual"><i class="fa-solid fa-pen-to-square"></i>Manual</button><button type="button" class="tab" data-target="qris"><i class="fa-solid fa-qrcode"></i> QRIS</button><button type="button" class="tab" data-target="qris2"><i class="fa-solid fa-wallet"></i> QRIS 2</button></div><div class="cepat-form-container qris-form-container"><div class="cepat-input-area"><div class="form-group"><div class="payment-method-box"><img src="https://garudasuper-cyou.pages.dev/logoQRIS.png" alt="QRIS Logo"></div></div><div class="form-group"><label>Pilih Nominal Cepat</label><div class="quick-amount-selector">${quickAmountButtonsHTML}</div></div><div class="form-group"><label for="qris-amount">Atau, Masukkan Jumlah Lain</label><div class="input-group-promo"><span class="input-group-text">Rp</span><input type="text" id="qris-amount" class="form-control" data-type="qris" placeholder="Contoh: 50.000"><span class="clear-input-btn">&times;</span><button type="button" class="promo-trigger-btn" title="Pilih Promosi"><i class="fa-solid fa-gift"></i></button><span class="bonus-label">BONUS</span></div><div class="unique-code-info"></div><div class="selected-promo-info"></div><div class="qris-validation-message"></div></div><button type="button" class="cepat-button qris-button"><span class="btn-text"><i class="fa-solid fa-qrcode"></i> Buat Kode QRIS</span></button></div><div class="result-container"></div></div><div class="cepat-form-container qris2-form-container"><div class="cepat-input-area"><div class="form-group"><label>Silahkan Transfer ke QRIS Berikut</label><div id="qris2-barcode-container"><i class="fa-solid fa-spinner fa-spin"></i>&nbsp; Memuat barcode... </div></div><div class="form-group"><label for="qris2-amount">Nominal Yang Ditransfer</label><div class="input-group-promo"><span class="input-group-text">Rp</span><input type="text" id="qris2-amount" class="form-control" placeholder="Contoh: 50.000"></div></div><div class="form-group"><label for="qris2-proof">Upload Bukti Transfer (Wajib)</label><input type="file" id="qris2-proof" class="form-control" accept="image/png, image/jpeg, image/jpg" name="receipt"></div><div class="qris-validation-message" id="qris2-validation-message"></div><button type="button" class="cepat-button qris2-button"><span class="btn-text"><i class="fa-solid fa-paper-plane"></i> Kirim Deposit</span></button></div><div class="result-container"></div></div></div><div class="promo-modal" id="promoModal"><div class="promo-modal-content"><div class="promo-modal-header"><h4>Pilih Promosi</h4><button type="button" class="close-modal-btn">&times;</button></div><div class="promo-modal-body"><p>Memuat promosi...</p></div></div></div>
`;const dF=$('form[action="/ajax/cm/reqDeposit"]');dF.each(function(){const cF=$(this);if(cF.find('.qris-cepat-wrapper-v11').length===0){const mFC=cF.children().wrapAll('<div class="manual-form-container-v11"></div>').parent();cF.prepend(hM);mFC.show();cF.find('.tab[data-target=manual]').addClass('active')}});if(!isMobileDevice()){$('.promo-trigger-btn, .bonus-label, .clear-input-btn').hide();$('.selected-promo-info').hide();$('#promoModal').remove()}
const sDS=(w,dA)=>{if(bC)clearInterval(bC);if(qT)clearInterval(qT);$.post('/ajax/cma2/allGameWalletRefresh');$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[2]==='number'){$('.g8-bal-total').text('IDR '+r[2].toLocaleString('id-ID'))}});let aFS=0;const aQD=sessionStorage.getItem('activeQrData');const aDD=sessionStorage.getItem('activeDanaData');if(aQD){aFS=JSON.parse(aQD).amount}else if(aDD){aFS=JSON.parse(aDD).amount}
sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const rC=w.find('.result-container');const fA=aFS.toLocaleString('id-ID');const sH=`<div class="success-container"><svg class="svg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="svg-checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="svg-checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg><h3>Deposit Berhasil!</h3><p>Saldo sebesar <strong>Rp ${fA}</strong> telah ditambahkan ke akun anda.</p></div>`;rC.html(sH).show();w.find('.cepat-input-area').hide();setTimeout(()=>{const sC=rC.find('.success-container');if(sC.length){sC.addClass('visible')}},10)};const sBC=(iB,w)=>{if(bC)clearInterval(bC);bC=setInterval(()=>{$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[2]==='number'){const cB=r[2];if(cB>iB){sDS(w,cB)}}}).fail(()=>{console.error("Gagal memeriksa saldo akun.")})},5000)};const sQT=(eT,w)=>{if(qT)clearInterval(qT);const tD=w.find('.payment-timer');qT=setInterval(()=>{const tLS=Math.round((eT-Date.now())/1000);if(tLS<0){clearInterval(qT);sQE(w);return}
const m=Math.floor(tLS/60);let s=tLS%60;s=s<10?'0'+s:s;tD.text(`${m}:${s}`)},1000)};const sQE=(w)=>{if(bC)clearInterval(bC);sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const eH=`<div class="expired-container"><h3>Waktu Pembayaran Habis!</h3><button type="button" class="buat-ulang-btn"><i class="fa-solid fa-rotate-right"></i> Buat Deposit Baru</button></div>`;w.find('.result-container').html(eH).show()};const dGQ=(d,w)=>{const{amount:a,expireTime:e,qrisString:q,initialBalance:i}=d;const mN=parseQrisMerchantName(q);const qP=generateQrisPayload(q,a.toString());const rH=`<div class="timer-container">Waktu Habis Dalam: <span class="payment-timer">-</span></div><div class="merchant-info"><i class="fa-solid fa-store"></i> Merchant: <strong class="merchant-name">${mN||'Tidak Dikenali'}</strong></div><div class="barcode-display"></div><strong class="final-amount">Rp ${a.toLocaleString('id-ID')}</strong><a href="#" class="download-btn"><i class="fa-solid fa-download"></i> Download QR</a>`;const rC=w.find('.result-container');rC.html(rH);const bD=rC.find('.barcode-display');new QRCode(bD[0],{text:qP,width:485,height:485,correctLevel:QRCode.CorrectLevel.Q});w.find('.cepat-input-area').hide();rC.show();sQT(e,w);sBC(i,w)};const lPIM=(aF)=>{const pMB=$('.promo-modal-body');const bI='4399:77';pMB.data('loaded-for',bI);pMB.html('<p style="color:#333;">Memuat promosi...</p>');$.ajax({url:'/ajax/credit/getDepositPromotion',type:'GET',dataType:'json',data:{bankId:bI},success:function(r){pMB.empty();pMB.append('<div class="promo-item active" data-promo-id=""><p>Tanpa Promosi</p></div>');if(r&&r[0]==='success'&&r[1].length>0){r[1].forEach(p=>{const pH=`<div class="promo-item" data-promo-id="${p[0]}"><p>${p[1]}</p></div>`;pMB.append(pH)})}},error:function(){pMB.html('<p style="color:#c62828;">Gagal memuat promosi. Coba lagi nanti.</p>')}})};const getAccountData=(callback)=>{if(accountData){callback(accountData);return}
$.get('/ajax/account/getAccountDto',function(r){if(r&&typeof r[4]==='string'&&r[4].length>=3){accountData=r;callback(r)}else{callback(null)}}).fail(()=>{callback(null)})};$('body').on('click','.promo-trigger-btn',function(){const aF=$(this).closest('.cepat-form-container');const pM=$('#promoModal');pM.data('active-form',aF.prop('className'));pM.addClass('modal-visible');const lF=pM.find('.promo-modal-body').data('loaded-for');const cB='4399:77';if(lF!==cB){lPIM(aF)}});$('body').on('click','.close-modal-btn',function(){$('#promoModal').removeClass('modal-visible')});$('body').on('click','.promo-item',function(){const pM=$('#promoModal');const aFCName=pM.data('active-form');const aF=$('.'+aFCName.split(' ').join('.'));const pId=$(this).data('promo-id');const pN=$(this).find('p').text();const amountInput=aF.find('.form-control');const sPI=aF.find('.selected-promo-info');const pTB=aF.find('.promo-trigger-btn');amountInput.data('promo-id',pId).data('min-deposit','');sPI.hide();pTB.removeClass('active');aF.find('.promo-item').removeClass('active');$(this).addClass('active');if(pId){pTB.addClass('active');if(pIR){pIR.abort()}
sPI.html('<i class="fa-solid fa-spinner fa-spin"></i> Memeriksa info...').show();pIR=$.ajax({url:'/ajax/deposit/getPromotionInfo',type:'GET',data:{id:pId},dataType:'json',success:function(r){if(r&&r.code==='200'){const{minDepositAmount:mDA,turnoverCondition:tC,maxBonusAmount:mBA}=r;const mB=parseFloat(mBA)*1000;amountInput.data('min-deposit',mDA);sPI.html(`<span class="clear-promo-btn" title="Hapus Promo">&times;</span><strong>${pN}</strong><br>Min. Depo: <strong>${parseFloat(mDA).toLocaleString('id-ID')}</strong> | TO: <strong>x${tC}</strong> | Max Bonus: <strong>${mB.toLocaleString('id-ID')}</strong>`).show()}else{sPI.text('Gagal memuat detail promo.').show()}},error:function(){sPI.text('Error saat mengambil info promo.').show()}})}
pM.removeClass('modal-visible')});$('body').on('click','.clear-promo-btn',function(){const wrapper=$(this).closest('.cepat-input-area');const sPI=wrapper.find('.selected-promo-info');const amountInput=wrapper.find('.form-control');const pTB=wrapper.find('.promo-trigger-btn');sPI.hide().html('');amountInput.data('promo-id','').data('min-deposit','');pTB.removeClass('active');$('#promoModal .promo-item').removeClass('active');$('#promoModal .promo-item[data-promo-id=""]').addClass('active')});$('body').on('click','.qris-cepat-wrapper-v11 .tab',function(){const cT=$(this);const t=cT.data('target');const w=cT.closest('.qris-cepat-wrapper-v11');if(cT.hasClass('active'))return;w.find('.tab').removeClass('active');cT.addClass('active');const pF=cT.closest('form');const manualForm=pF.find('.manual-form-container-v11');const qrisForm=w.find('.qris-form-container');const qris2Form=w.find('.qris2-form-container');manualForm.hide();qrisForm.hide();qris2Form.hide();if(t==='manual'){manualForm.show()}else if(t==='qris'){qrisForm.show();const aQD=sessionStorage.getItem('activeQrData');if(aQD&&Date.now()<JSON.parse(aQD).expireTime){const qD=JSON.parse(aQD);if(qD.qrisString&&typeof qD.initialBalance==='number'){dGQ(qD,qrisForm)}}else{sessionStorage.removeItem('activeQrData');qrisForm.find('.cepat-input-area').show();qrisForm.find('.result-container').empty()}}else if(t==='qris2'){qris2Form.show();const barcodeContainer=w.find('#qris2-barcode-container');if(barcodeContainer.find('img').length===0){barcodeContainer.html('<i class="fa-solid fa-spinner fa-spin"></i>&nbsp; Memuat barcode...');$.ajax({url:'https://qriscepat.garuda999.workers.dev/api/barcode',type:'GET',dataType:'json',success:function(response){if(response.success&&response.attachId){const imageUrl=`/stream/id?attachId=${response.attachId}`;barcodeContainer.html(`<img src="${imageUrl}" alt="QRIS 2 Barcode" style="max-width:80%; height:auto;">`)}else{barcodeContainer.html('<span style="color:red;">Sistem pembayaran sedang dalam pemeliharaan.</span>')}},error:function(){barcodeContainer.html('<span style="color:red;">Gagal memuat barcode. Silahkan coba lagi.</span>')}})}}});$('body').on('click','.quick-amount-btn',function(){const cB=$(this);const iA=cB.closest('.cepat-input-area');const amountInput=iA.find('.form-control');amountInput.data('unique-code','');amountInput.val(parseInt(cB.data('amount'))).trigger('input').removeClass('is-invalid');iA.find('.qris-validation-message').hide()});$('body').on('input','.form-control[data-type], #qris2-amount',function(event){const input=$(this);const formGroup=input.closest('.form-group');const infoDiv=formGroup.find('.unique-code-info');const clearBtn=formGroup.find('.clear-input-btn');const type=input.data('type');input.removeClass('is-invalid');formGroup.find('.qris-validation-message').hide();let rawValue=input.val().replace(/[^\d]/g,'');if(rawValue&&parseInt(rawValue,10)>10000000){rawValue='10000000'}
const nominal=parseInt(rawValue,10)||0;input.closest('.cepat-input-area').find('.quick-amount-btn').each(function(){const btn=$(this);if(parseInt(btn.data('amount'),10)===nominal){btn.addClass('active')}else{btn.removeClass('active')}});input.val(rawValue?nominal.toLocaleString('id-ID'):'');if(nominal>0){if(type==='qris'){if(nominal===10000000){let uniqueCode=0;input.data('unique-code',uniqueCode);const totalAmount=nominal;infoDiv.html(`Total Transfer: <strong style="color: #00a2b1;">Rp ${totalAmount.toLocaleString('id-ID')}</strong>`).show()}else{let uniqueCode=input.data('unique-code');if(!uniqueCode||uniqueCode===0){uniqueCode=Math.floor(Math.random()*90)+10;input.data('unique-code',uniqueCode)}
const totalAmount=nominal+uniqueCode;infoDiv.html(`Kode Unik: <strong style="color: #d9534f;">${uniqueCode}</strong> &bull; Total Transfer: <strong style="color: #00a2b1;">Rp ${totalAmount.toLocaleString('id-ID')}</strong>`).show()}}}else{infoDiv.hide();input.data('unique-code','')}
if(input.val().length>0){if(clearBtn.is(":visible")){clearBtn.show()}}else{if(clearBtn.is(":visible")){clearBtn.hide()}}});$('body').on('click','.clear-input-btn',function(){const nominalInput=$(this).siblings('.form-control');nominalInput.val('');nominalInput.trigger('input');$(this).hide()});$('body').on('click','.qris-button',async function(){const gB=$(this);const w=gB.closest('.cepat-form-container');const aI=w.find('input[data-type="qris"]');const vM=aI.closest('.form-group').find('.qris-validation-message');const btnTextDefault='<span class="btn-text"><i class="fa-solid fa-qrcode"></i> Buat Kode QRIS</span>';aI.removeClass('is-invalid');vM.hide();let aV=aI.val().replace(/[^\d]/g,'');if(!aV||parseInt(aV,10)===0){aI.addClass('is-invalid');vM.text("Silahkan isi nominal terlebih dahulu.").show();return}
const pA=parseInt(aV,10),pId=aI.data('promo-id')||"",mDP=aI.data('min-deposit');if(pId&&mDP){if(pA<mDP){aI.addClass('is-invalid');vM.text(`Minimal deposit untuk promo ini adalah Rp ${parseInt(mDP).toLocaleString('id-ID')}.`).show();return}}else{if(pA<25000){aI.addClass('is-invalid');vM.text("Minimal deposit adalah Rp 25.000.").show();return}}
if(pA>10000000){aI.addClass('is-invalid');vM.text("Maksimal deposit adalah Rp 10.000.000.").show();return}
const uniqueCode=aI.data('unique-code');if(typeof uniqueCode==='undefined'||uniqueCode===''){vM.text("Gagal mendapatkan kode unik. Silahkan coba ketik ulang nominal.").show();return}
gB.prop('disabled',!0).html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Memproses...</span>');try{const aD=await $.get('/ajax/account/getAccountDto');if(!aD||typeof aD[2]!=='number'){throw new Error('Gagal mendapatkan informasi saldo saat ini.')}
const iB=aD[2];const qCR=await fetch('https://qriscepat.garuda999.workers.dev/api/config');if(!qCR.ok){throw new Error('Network response was not ok')}
const qC=await qCR.json();if(qC.maintenanceMode||!qC.qrisString){throw new Error("Sistem pembayaran sedang dalam pemeliharaan.")}
const aWUC=pA+parseInt(uniqueCode,10);const bI='4399:77';const tR='QRIS CEPAT';const tRI=gB.closest('form').find('input[name="telcoRemark"]');tRI.val(tR);const dD={amount:aWUC,bankId:bI,promotionId:pId,telcoRemark:tR};$.ajax({type:'POST',url:'/ajax/cm/reqDeposit',data:dD,success:function(r){if(r&&Array.isArray(r)&&r[0]==='error.ex'){const eM=r[1]||"";let uM;if(eM.includes("Maximum 1 pending deposit request confirmation")){uM="Hanya boleh ada 1 permintaan deposit yang pending."}else if(eM.includes("tunggu beberapa saat untuk deposit kembali")){uM="Tunggu sebentar sebelum mencoba deposit kembali."}else if(eM.includes("mengambil promo bonus")){uM="Deposit gagal karena promo bonus masih aktif. Silahkan hubungi CS untuk bantuan."}else{uM=eM||"Terjadi kesalahan yang tidak diketahui."}
vM.text('Gagal: '+uM).show()}else{const qrData={amount:aWUC,expireTime:Date.now()+300*1000,qrisString:qC.qrisString,initialBalance:iB};const sessionKey='activeQrData';sessionStorage.setItem(sessionKey,JSON.stringify(qrData));dGQ(qrData,w)}},error:function(){vM.text('Gagal: Terjadi kesalahan koneksi. Silahkan coba lagi.').show()},complete:function(){gB.prop('disabled',!1).html(btnTextDefault)}})}catch(e){vM.text('Gagal: '+e.message).show();gB.prop('disabled',!1).html(btnTextDefault)}});$('body').on('click','.qris2-button',async function(){const btn=$(this);const w=btn.closest('.qris2-form-container');const amountInput=w.find('#qris2-amount');const proofInput=w.find('#qris2-proof');const validationMessage=w.find('#qris2-validation-message');const btnTextDefault='<span class="btn-text"><i class="fa-solid fa-paper-plane"></i> Kirim</span>';validationMessage.hide();amountInput.removeClass('is-invalid');proofInput.removeClass('is-invalid');const amountValue=amountInput.val().replace(/[^\d]/g,'');let proofFile=proofInput[0].files[0];if(!amountValue||parseInt(amountValue,10)<=0){validationMessage.text('Silahkan isi nominal yang valid.').show();amountInput.addClass('is-invalid');return}
if(parseInt(amountValue,10)<25000){validationMessage.text('Minimal deposit adalah Rp 25.000.').show();amountInput.addClass('is-invalid');return}
if(!proofFile){validationMessage.text('Silahkan upload bukti transfer.').show();proofInput.addClass('is-invalid');return}
btn.prop('disabled',!0);if(proofFile.size>1*1024*1024){try{btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengompres gambar...</span>');proofFile=await compressImage(proofFile)}catch(error){validationMessage.text('Gagal memproses gambar. Coba file lain.').show();btn.prop('disabled',!1).html(btnTextDefault);return}}
btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengupload...</span>');const uploadFormData=new FormData();uploadFormData.append('receipt',proofFile,'compressed-proof.jpg');$.ajax({url:'/upload/id?attachType=7',type:'POST',data:uploadFormData,processData:!1,contentType:!1,success:function(uploadResponse){btn.html('<span class="btn-text"><i class="fa-solid fa-spinner fa-spin"></i> Mengonfirmasi...</span>');const depositData={bankId:'4399:77',amount:amountValue,telcoRemark:'QRIS MANUAL',promotionId:''};$.ajax({url:'/ajax/cm/reqDeposit',type:'POST',data:depositData,success:function(depositResponse){if(depositResponse&&Array.isArray(depositResponse)&&depositResponse[0]==='error.ex'){const eM=depositResponse[1]||"";let uM;if(eM.includes("Maximum 1 pending deposit request confirmation")){uM="Hanya boleh ada 1 permintaan deposit yang pending."}else if(eM.includes("tunggu beberapa saat untuk deposit kembali")){uM="Tunggu sebentar sebelum mencoba deposit kembali."}else if(eM.includes("mengambil promo bonus")){uM="Deposit gagal karena promo bonus masih aktif. Silahkan hubungi CS untuk bantuan."}else{uM=eM||"Terjadi kesalahan yang tidak diketahui."}
validationMessage.text('Gagal: '+uM).show();btn.prop('disabled',!1).html(btnTextDefault)}else{w.find('.cepat-input-area').hide();const successHTML=`<div class="success-container visible">
                                    <svg class="svg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="svg-checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="svg-checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>
                                    <h3>Deposit Terkirim!</h3>
                                    <p>Konfirmasi deposit Anda telah berhasil dan akan segera kami proses.</p>

                                </div>`;w.find('.result-container').html(successHTML)}},error:function(){validationMessage.text('Gagal konfirmasi deposit. Silahkan hubungi CS.').show();btn.prop('disabled',!1).html(btnTextDefault)}})},error:function(){validationMessage.text('Gagal mengupload bukti transfer. Periksa koneksi Anda.').show();btn.prop('disabled',!1).html(btnTextDefault)}})});$('body').on('click','.buat-ulang-btn',function(){if(qT)clearInterval(qT);if(bC)clearInterval(bC);sessionStorage.removeItem('activeQrData');sessionStorage.removeItem('activeDanaData');const w=$(this).closest('.cepat-form-container');w.find('.result-container').empty();w.find('.cepat-input-area').show()});$('body').on('click','.download-btn',function(e){e.preventDefault();const w=$(this).closest('.result-container'),c=w.find('.barcode-display canvas')[0],a=w.find('.final-amount').text().replace(/[^0-9]/g,'');if(c){const p=30,n=document.createElement('canvas');n.width=c.width+p;n.height=c.height+p;const x=n.getContext('2d');x.fillStyle='#FFFFFF';x.fillRect(0,0,n.width,n.height);x.drawImage(c,p/2,p/2);const l=document.createElement('a');l.href=n.toDataURL("image/png");l.download=`QRIS-Payment-${a}.png`;l.click()}});const cAQL=()=>{const aQD=sessionStorage.getItem('activeQrData');const qW=$('.qris-form-container:visible');if(qW.length>0&&aQD&&Date.now()<JSON.parse(aQD).expireTime){const qD=JSON.parse(aQD);if(qD.qrisString&&typeof qD.initialBalance==='number'){qW.closest('.qris-cepat-wrapper-v11').find('.tab[data-target="qris"]').trigger('click')}}};setTimeout(cAQL,500)})}



